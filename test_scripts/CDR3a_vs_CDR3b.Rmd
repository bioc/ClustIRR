---
title: "CDR3a vs CDR3b"
output:
  html_document:
    df_print: paged
---

---
title: "CDR3a vs CDR3b"
output:
  html_document:
    df_print: paged
---

```{r load, include=FALSE}
library(ClustIRR)
#devtools::load_all(".")

```

# Test data

CDR3b and CDR3a sequences, two different clones inserted and a motif inserted.

* **Clone 1**: 13 times *CATSRLEFAQYF* 
  * Global and local enrichment
* **Clone 2**: 7 times *CATSRLEARATYF* 
  * Global and local enrichment and motif *LEAR*
* **Clone 2**: 2 times *CATSEEEFAQYF* 
  * only global, no local enrichment
* **Motif**: 5 times *LEAR* 
  * Also to be found in **Clone 2**

```{r prepare, include=FALSE}
data("CDR3ab")

# CDR3a
s_a <- CDR3ab[4501:5000,]
s_a$CDR3b <- NULL
r_a <- CDR3ab[5001:10000,]
r_a$CDR3b <- NULL

# CDR3b
s_b <- CDR3ab[4501:5000,]
s_b$CDR3a <- NULL
r_b <- CDR3ab[5001:10000,]
r_b$CDR3a <- NULL

# alpha clones + motifs
clone1_a <- data.frame(CDR3a = rep("CAWNQEEETYEQYF", times = 20))
clone2_a <- data.frame(CDR3a = rep("CAWNQEETTYEQYF", times = 5)) #CAWNQEETRTYEQYF
clone3_a <- data.frame(CDR3a = rep("CASSSLYNETTYF", times = 2))
s_a <- rbind(s_a, clone1_a)
s_a <- rbind(s_a, clone2_a)
s_a <- rbind(s_a, clone3_a)
substr(x = s_a$CDR3a[51:60], start = 6, stop = 9) <- "GPPN"
substr(x = s_a$CDR3a[20:25], start = 5, stop = 8) <- "REAL"

# beta clones + motifs
clone1_b <- data.frame(CDR3b = rep("CATSRLEFAQYF", times = 10))
clone2_b <- data.frame(CDR3b = rep("CATSRLEARATYF", times = 15))
clone3_b <- data.frame(CDR3b = rep("CATSEEEFAQYF", times = 2))
s_b <- rbind(s_b, clone1_b)
s_b <- rbind(s_b, clone2_b)
s_b <- rbind(s_b, clone3_b)
substr(x = s_b$CDR3b[1:10], start = 4, stop = 7) <- "LEAR"
substr(x = s_b$CDR3b[20:25], start = 5, stop = 8) <- "REAL"


# alpha & beta combined
s_ab <- cbind(s_a, s_b)
r_ab <- cbind(r_a, r_b)

rm(clone1_a, clone2_a, clone3_a, clone1_b, clone2_b, clone3_b)

```


```{r run_clustirr, include=FALSE}
out1 <- cluster_irr(s = s_ab,
                   r = r_ab,
                   version = 1,
                   ks = 4,
                   cores = 8,
                   control = list(trim_flank_aa = 3))

out2 <- cluster_irr(s = s_ab,
                   r = r_ab,
                   version = 2,
                   ks = 4,
                   cores = 8,
                   control = list(trim_flank_aa = 3))

out3 <- cluster_irr(s = s_ab,
                    r = r_ab,
                    version = 3,
                    ks = 4,
                    cores = 8,
                    control = list(trim_flank_aa = 3))
```

```{r run_clustirr_alpha, include=FALSE}
out1_a <- cluster_irr(s = s_a,
                   r = r_a,
                   version = 1,
                   ks = 4,
                   cores = 8,
                   control = list(trim_flank_aa = 3))

out2_a <- cluster_irr(s = s_a,
                   r = r_a,
                   version = 2,
                   ks = 4,
                   cores = 8,
                   control = list(trim_flank_aa = 3))

out3_a <- cluster_irr(s = s_a,
                    r = r_a,
                    version = 3,
                    ks = 4,
                    cores = 8,
                    control = list(trim_flank_aa = 3))
```


```{r run_clustirr_beta, include=FALSE}
out1_b <- cluster_irr(s = s_b,
                   r = r_b,
                   version = 1,
                   ks = 4,
                   cores = 8,
                   control = list(trim_flank_aa = 3))

out2_b <- cluster_irr(s = s_b,
                   r = r_b,
                   version = 2,
                   ks = 4,
                   cores = 8,
                   control = list(trim_flank_aa = 3))

out3_b <- cluster_irr(s = s_b,
                    r = r_b,
                    version = 3,
                    ks = 4,
                    cores = 8,
                    control = list(trim_flank_aa = 3))
```

# ClustIRR v3

```{r check_clustirr_v3}
# beta chain
plot_graph(out3_b)
plot_graph(out3_b, expand_clones = TRUE)
# alpha chain
plot_graph(out3_a)
plot_graph(out3_a, expand_clones = TRUE)
# beta & alpha chain
plot_graph(out3)
plot_graph(out3, expand_clones = TRUE)
```

# ClustIRR v2

```{r check_clustirr_v2}
# beta chain
plot_graph(out2_b)
# alpha chain
plot_graph(out2_a)
# beta & alpha chain
plot_graph(out2)
```

# ClustIRR v1

```{r check_clustirr_v1}
# beta chain
plot_graph(out1_b)
# alpha chain
plot_graph(out1_a)
# beta & alpha chain
plot_graph(out1)
```


